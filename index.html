<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/konva@8.2.0/konva.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="container"></div>
  <script>
    const screenWidth = window.innerHeight;
    const screenHeight = window.innerHeight;
    const stage = new Konva.Stage({
        container: 'container',
        width: screenWidth,
        height: screenHeight
      });
    const layer = new Konva.Layer();
    stage.add(layer);

    const getPointOnLine = (lineStartX, lineStartY, lineEndX, lineEndY, distance) => {
      const directionVectorX = lineEndX - lineStartX;
      const directionVectorY = lineEndY - lineStartY;
      const directionVectorLength = Math.sqrt(directionVectorX * directionVectorX + directionVectorY * directionVectorY);
      const normalizedDirectionVectorX = directionVectorX / directionVectorLength;
      const normalizedDirectionVectorY = directionVectorY / directionVectorLength;
      const displacementVectorX = normalizedDirectionVectorX * distance;
      const displacementVectorY = normalizedDirectionVectorY * distance;
      const pointX = lineStartX + displacementVectorX;
      const pointY = lineStartY + displacementVectorY;
      return { x: pointX, y: pointY };
    }

    const connectDots = (x1, y1, x2, y2) => {
      const line = new Konva.Line({
        points: [x1 * screenWidth, y1 * screenHeight, x2 * screenWidth, y2 * screenHeight],
        stroke: 'black',
        strokeWidth: 2
      });
      layer.add(line);
    }
   
    const gridSpacing = 0.1; 
    for (let x = 0; x <= 1; x += gridSpacing) {
      const verticalLine = new Konva.Line({
        points: [x * screenWidth, 0, x * screenWidth, screenHeight],
        stroke: 'lightgray',
        strokeWidth: 1
      });
      layer.add(verticalLine);
    }
    for (let y = 0; y <= 1; y += gridSpacing) {
      const horizontalLine = new Konva.Line({
        points: [0, y * screenHeight, screenWidth, y * screenHeight],
        stroke: 'lightgray',
        strokeWidth: 1
      });
      layer.add(horizontalLine);
    }

    const drawLines = (a, b, c) => {
      a = { x: a.x, y: 1 - a.y };
      b = { x: b.x, y: 1 - b.y };
      c = { x: c.x, y: 1 - c.y };

      const lineBToA = {
        points: [b.x * screenWidth, b.y * screenHeight, a.x * screenWidth, a.y * screenHeight],
        stroke: 'black',
        strokeWidth: 2
      };

      const lineBToC = {
        points: [b.x * screenWidth, b.y * screenHeight, c.x * screenWidth, c.y * screenHeight],
        stroke: 'black',
        strokeWidth: 2
      };

      const vectorBA = { x: a.x - b.x, y: a.y - b.y };
      const vectorBC = { x: c.x - b.x, y: c.y - b.y };
      const dotProduct = vectorBA.x * vectorBC.x + vectorBA.y * vectorBC.y;
      const magnitudeBA = Math.sqrt(vectorBA.x * vectorBA.x + vectorBA.y * vectorBA.y);
      const magnitudeBC = Math.sqrt(vectorBC.x * vectorBC.x + vectorBC.y * vectorBC.y);
      const angleInRadians = Math.acos(dotProduct / (magnitudeBA * magnitudeBC));
      const angleInDegrees = (angleInRadians * 180) / Math.PI;

      const vectorBRight = { x: 1, y: 0 };
      const dotProduct2 = vectorBRight.x * vectorBC.x + vectorBRight.y * vectorBRight.y;
      const magnitudeBRight = Math.sqrt(vectorBRight.x * vectorBRight.x + vectorBRight.y * vectorBRight.y);
      const magnitudeBC2 = Math.sqrt(vectorBC.x * vectorBC.x + vectorBC.y * vectorBC.y);
      const angleInRadians2 = Math.acos(dotProduct2 / (magnitudeBRight * magnitudeBC2));
      const angleInDegrees2 = (angleInRadians2* 180) / Math.PI;

      const lineBA = new Konva.Line(lineBToA);
      const lineBC = new Konva.Line(lineBToC);

      const centerX = b.x * screenHeight;
      const centerY = b.y * screenHeight;
      const radius = 0.03 * screenHeight;
      const startAngle = angleInDegrees2; 
      const endAngle = angleInDegrees2 + angleInDegrees; 
      const sign = vectorBC.y === 0 ? 1 : vectorBC.y / Math.abs(vectorBC.y);
      const sector = new Konva.Wedge({
        x: centerX,
        y: centerY,
        radius: radius,
        angle: Math.abs(endAngle - startAngle),
        rotation: sign * startAngle,
        fill: 'blue',
        stroke: 'black',
        strokeWidth: 1,
        opacity: 0.15,
      });
      
      let newDot1 = getPointOnLine(b.x, b.y, a.x, a.y, 0.1);
      let newDot2 = getPointOnLine(b.x, b.y, c.x, c.y, 0.1);

      const textX = (newDot1.x + newDot2.x) / 2;
      const textY = (newDot1.y + newDot2.y) / 2;

      const angleText = `${angleInDegrees.toFixed(2)}Â°`;
      const text = new Konva.Text({
        x: textX * screenHeight,
        y: textY * screenHeight,
        offsetX: 0.015 * screenHeight,
        offsetY: 0.015 * screenHeight,
        text: angleText,
        fontSize: 14,
        fontFamily: 'Arial',
        fill: 'black',
      });

      layer.add(lineBA, lineBC, sector, text);
    }

    const dotDistance = (x, y) => {
      y = 1 - y;
      const circle = new Konva.Circle({
        x: x * screenHeight,
        y: y * screenHeight,
        radius: 0.005 * screenHeight,
        fill: 'red',
        strokeWidth: 4,
      });
      const xDistance = Math.abs(0.5 - x);
      const yDistance1 = Math.abs(1 - y);
      const yDistance2 = Math.abs(0 - y);
      const avgX = (x + 0.5) / 2 * screenHeight;
      let avgY;
      let yDistance;
      if(yDistance1 < yDistance2){
        const line = new Konva.Line({
          points: [x * screenWidth, y * screenHeight, x * screenWidth, screenHeight],
          stroke: 'black',
          strokeWidth: 1,
          dash: [10, 10],
        });
        avgY = (y + 1) / 2 * screenHeight;
        yDistance = yDistance1;
        layer.add(line);
      }
      else{
          const line = new Konva.Line({
          points: [x * screenWidth, y * screenHeight, x * screenWidth, 0],
          stroke: 'black',
          strokeWidth: 1,
          dash: [10, 10],
        });
        avgY = y / 2 * screenHeight;
        yDistance = yDistance2;
        layer.add(line);
      }
      const line = new Konva.Line({
          points: [x * screenWidth, y * screenHeight, 0.5 * screenWidth, y * screenHeight],
          stroke: 'black',
          strokeWidth: 1,
          dash: [10, 10],
      });
      const textX = new Konva.Text({
        x: avgX,
        y: y * screenHeight,
        text: `${xDistance.toFixed(2)}`,
        fontSize: 12,
        fill: 'red',
      });
      const textY = new Konva.Text({
        x: x * screenHeight,
        y: avgY,
        text: `${yDistance.toFixed(2)}`,
        fontSize: 12,
        fill: 'red',
      });
      layer.add(circle, line, textX, textY);
    }

    drawLines({x: 0.2, y: 0.3}, {x: 0.1, y: 0.5}, {x: 0.8, y: 0.4});
    drawLines({x: 0.1, y: 0.5}, {x: 0.8, y: 0.4}, {x: 0.6, y: 0.3});
    drawLines({x: 0.8, y: 0.4}, {x: 0.6, y: 0.3}, {x: 0.2, y: 0.3});
    drawLines({x: 0.6, y: 0.3}, {x: 0.2, y: 0.3}, {x: 0.1, y: 0.5});
    dotDistance(0.8, 0.9);
    dotDistance(0.1, 0.7);
    dotDistance(0.6, 0.2);
    layer.draw();
  </script>
</body>
</html>


